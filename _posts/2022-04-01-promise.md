---
published: true
title: "Java script ES6ğŸ’« ì¤‘ê¸‰ğŸ”¥ âœï¸ (5) Promise"
permalink: /es62/test
tags:
  - [es62]

navigation: true
toc: true
toc_sticky: true

date: 2022-04-01
last_modified_at: 2022-04-01
---

![]()



# 16. Promise

## 16-1. ì†Œê°œ

#### Callback Hell

- idê°€ 'btn'ì¸ buttonì„ í´ë¦­í•˜ë©´ ì„œë²„ì— users ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ìš”ì²­ì„ í•˜ê³ ,
- ì„±ê³µí•˜ë©´ listì˜ ì„¸ë²ˆì§¸ userì˜ ì •ë³´ë¥¼ ë‹¤ì‹œ ìš”ì²­í•˜ì—¬
- ì„±ê³µí•˜ë©´ userì˜ profileImage urlê°’ì„ ê°€ì ¸ë‹¤ê°€ image íƒœê·¸ë¡œ í‘œí˜„í•˜ê³ ,
- ì´ imageë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ì œê±°.

```js
const script= document.createElement('script')
script.src= 'https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'
document.body.appendChild(script)

document.body.innerHTML += '<button id="btn">í´ë¦­</button>'
document.getElementById('btn').addEventListener('click', function (e) {
  $.ajax({
    method: 'GET',
    url: 'https://api.github.com/users?since=1000',
    success: function (data) {
      var target = data[2]
      $.ajax({
        method: 'GET',
        url: 'https://api.github.com/user/' + target.id,
        success: function (data) {
          var _id = 'img' + data.id
          document.body.innerHTML += '<img id="' + _id + '" src="' + data.avatar_url + '"/>'
          document.getElementById(_id).addEventListener('click', function (e) {
            this.remove()
          })
        },
        error: function (err) {
          console.error(err)
        }
      })
    },
    error: function (err) {
      console.error(err)
    }
  })
})
```

ì´ë ‡ê²Œ ì˜†ìœ¼ë¡œ íŒŒê³ ë“œëŠ” êµ¬ì¡°ë³´ë‹¤ëŠ” ìˆœì°¨ì ì¸ ì‹œí€€ìŠ¤ê°€ ì¢‹ë‹¤.<br/>
ê·¸ë˜ì„œ ë“±ì¥í•œ ê²Œ `Promise`


#### Promise

```js
document.body.innerHTML = '<button id="btn">í´ë¦­</button>'
document.getElementById('btn').addEventListener('click', function (e) {
    fetch('https://api.github.com/users?since=1000')
    .then(function (res) { return res.json() })
    .then(function (res) {
        var target = res[2]
        return fetch('https://api.github.com/user/' + target.id)
    })
    .then(function (res) { return res.json() })
    .then(function (res) {
        var _id = 'img' + res.id
        document.body.innerHTML += '<img id="' + _id + '" src="' + res.avatar_url + '"/>'
        document.getElementById(_id).addEventListener('click', function (e) {
            this.remove()
        })
    })
    .catch(function (err) {
        console.error(err)
    })
})
```


.thenì„ ì‚¬ìš©í•´ì„œ ë™ì‘ì´ ëë‚˜ë©´ ë‹¤ìŒ ë™ì‘ìœ¼ë¡œ, ìˆœì°¨ì ì¸ íë¦„ìœ¼ë¡œ ë³€ê²½

#### Promiseë¥¼ ë°˜í™˜í•˜ë©´ì„œ JSON parsingì„ ìë™ìœ¼ë¡œ í•´ì£¼ëŠ” library (axios) í™œìš©ì‹œ

```js
const script= document.createElement('script')
script.src= 'https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js'
document.body.appendChild(script)

document.body.innerHTML += '<button id="btn">í´ë¦­</button>'
document.getElementById('btn').addEventListener('click', function (e) {
    axios.get('https://api.github.com/users?since=1000')
    .then(function (res) {
        var target = res.data[2]
        return axios.get('https://api.github.com/user/' + target.id)
    })
    .then(function (res) {
        var _id = 'img' + res.data.id
        document.body.innerHTML += '<img id="' + _id + '" src="' + res.data.avatar_url + '"/>'
        document.getElementById(_id).addEventListener('click', function (e) {
            this.remove()
        })
    })
    .catch(function (err) {
        console.error(err)
    })
})
```

.then(function (res) { return res.json() })<br/>
ë°˜ë³µë˜ëŠ” ì´ ë¶€ë¶„ì„ axiosë¡œ í•œë²ˆì— ì²˜ë¦¬

thenìœ¼ë¡œ ì½œë°±í•¨ìˆ˜ë¥¼ ê³„ì† ë„˜ê¸°ëŠ” íŒ¨í„´ì€ ì•„ì§ ë‚¨ì•„ìˆì§€ë§Œ, then ì‚¬ìš© ì „ë³´ë‹¤ëŠ” ì½œë°±ì§€ì˜¥ì„ í•´ê²°.


## 16-2. ìƒì„¸

<img src="/assets/images/promise.png" /><br/>

thenê³¼ catch ë©”ì†Œë“œê°€ `prototype` ì•ˆì— ìˆë‹¤.<br/>

promiseë¥¼ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ë¡œ ìƒê°ì„ í•˜ë©´,<br/>
promiseëŠ” ìƒì„±ì í•¨ìˆ˜ë¡œ (Classë¡œ) ë§Œë“  **ì¸ìŠ¤í„´ìŠ¤**ë¡œì„œ prototype ìƒìœ¼ë¡œ thenê³¼ catch ë©”ì†Œë“œì— ì ‘ê·¼ì´ ëœë‹¤.<br/>
ê·¸ ì™¸ì˜ all, reject, resolve ì´ëŸ° ë©”ì†Œë“œëŠ” promise ìì²´ì— ë‚´ì¥ëœ `static ë©”ì†Œë“œ`!<br/>

Promise.all **(O)** <br/>
new Promise().all **(X)** ì¸ìŠ¤í„´ìŠ¤ë¡œ ë§Œë“¤ë©´ `ì ‘ê·¼ ë¶ˆê°€ëŠ¥` <br/>


### 16-2-1. Promise Status

ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ í•´ë‘ë©´ ì•Œì•„ì„œ ìƒíƒœ ì²˜ë¦¬ë¥¼ í•´ì„œ ëŒë ¤ì¤€ë‹¤.
 
- unnsettled (ë¯¸í™•ì •) ìƒíƒœ: pending. **`thenable`**í•˜ì§€ ì•Šë‹¤.
ì–´ë–¤ ìš”ì²­ì´ ìˆì–´ì„œ ì´ê²Œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ê°€ ë ê±´ë°, ê·¸ ë¹„ë™ê¸°ì²˜ë¦¬ ê³¼ì •ì´ ëë‚˜ê¸° ì „ ìƒíƒœ

- settled (í™•ì •) ìƒíƒœ: resolved. **`thenable`**í•œ ìƒíƒœ.
ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ëë‚˜ê³  ë‚˜ë©´ ìƒíƒœê°€ settledë¡œ ë°”ë€ë‹¤
   - fulfilled (ì„±ê³µ)
  - rejected (ì‹¤íŒ¨)

<br/>

const a = new Promise() <br/>
ì´ë ‡ê²Œë§Œ í•´ë„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì§€ë§Œ ë§¤ê°œë³€ìˆ˜ë¥¼ ë„˜ê¸¸ ìˆ˜ ìˆìŒ. <br/>

```js
const a = new Promise(function(ì„±ê³µì‹œí˜¸ì¶œí•¨ìˆ˜, ì‹¤íŒ¨ì‹œí˜¸ì¶œí•¨ìˆ˜) {
  // ì‹¤ì œ ë™ì‘ì„ êµ¬í˜„í•˜ê³ ,
  // ì´ ë™ì‘ì´ ì„±ê³µí•˜ë©´ ì„±ê³µì‹œí˜¸ì¶œí•¨ìˆ˜,
  // ì‹¤íŒ¨í•˜ë©´ ì‹¤íŒ¨ì‹œí˜¸ì¶œí•¨ìˆ˜ë¥¼ ë‚´ë¶€ì—ì„œ êµ¬í˜„í•´ë‘ë©´ ëœ
})
```

ê·¸ë ‡ê²Œ ë³´ë©´

```js
const promiseTest = param => new Promise((resolve, reject) => {
	setTimeout(() => {
		if (param) {
			resolve("í•´ê²° ì™„ë£Œ")
		} else {
			reject(Error("ì‹¤íŒ¨!!"))
		}
	}, 1000)
})

```

promiseTestë¼ëŠ” í•¨ìˆ˜ëŠ” paramì„ ë°›ì•„ì„œ, <br/>
Promiseì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“  ê±¸ ë°˜í™˜í•˜ê³  ìˆë‹¤<br/>

ê·¸ëŸ¼ promiseTestì— paramì„ ë„˜ê²¨ì„œ ì‹¤í–‰í•œ ê²°ê³¼ê°’ì€ ì•„ë˜ì™€ ë™ì¼.


```js
const a = new Promise(function(ì„±ê³µì‹œí˜¸ì¶œí•¨ìˆ˜, ì‹¤íŒ¨ì‹œí˜¸ì¶œí•¨ìˆ˜) {
  // ì‹¤ì œ ë™ì‘ì„ êµ¬í˜„í•˜ê³ ,
  // ì´ ë™ì‘ì´ ì„±ê³µí•˜ë©´ ì„±ê³µì‹œí˜¸ì¶œí•¨ìˆ˜,
  // ì‹¤íŒ¨í•˜ë©´ ì‹¤íŒ¨ì‹œí˜¸ì¶œí•¨ìˆ˜ë¥¼ ë‚´ë¶€ì—ì„œ êµ¬í˜„í•´ë‘ë©´ ëœ
})
```


```js
const promiseTest = param => new Promise((resolve, reject) => {
	setTimeout(() => {
		if (param) {
			resolve("í•´ê²° ì™„ë£Œ")
		} else {
			reject(Error("ì‹¤íŒ¨!!"))
		}
	}, 1000)
})

const a = promiseTest(true)
a
// Promise {<resolved>: "í•´ê²° ì™„ë£Œ"}
```

new Promiseë¡œ **ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ìˆœê°„ì— `ë‚´ë¶€í•¨ìˆ˜ë¥¼ ì‹¤í–‰`**í•œë‹¤. <br/>
ê·¸ëŸ¼ ê·¸ ë‚´ë¶€ì—ì„œëŠ”,<br/>
setTimeoutì„ ëŒë©´ì„œ 1ì´ˆ ë’¤ì— ì•ˆì— ìˆëŠ” ë‚´ìš©ì„ ì‹¤í–‰<br/>

ê·¸ë•Œì— ë„˜ê²¨ë°›ì€ **true**ë¡œ ì¸í•´ **`resolve`ê°€ í˜¸ì¶œ**ëê³ , <br/>
resolveì— ì˜í•´ì„œ promiseì˜ ì „ì²´ìƒíƒœê°€ unsettledì—ì„œ `settled`ë¡œ ë³€ê²½ë˜ê³ <br/>
ê·¸ ê²°ê³¼ê°€ fulfilledê°€ ë¨<br/>


```js
const promiseTest = param => new Promise((resolve, reject) => {
	setTimeout(() => {
		if (param) {
			resolve("í•´ê²° ì™„ë£Œ")
		} else {
			reject(Error("ì‹¤íŒ¨!!"))
		}
	}, 1000)
})

const b = promiseTest(false)
// Uncaught (in promise) Error: ì‹¤íŒ¨!!
b
// Promise {<reject>: "ì‹¤íŒ¨!!"}
```

ì„±ê³µì‹œì—ëŠ” resolvedë¼ê³  ë‚˜ì™”ëŠ”ë° ì™œ rejectë¼ê³  ë‚˜ì˜¬ê¹Œ? <br/>
=> ë¸Œë¼ìš°ì €ë§ˆë‹¤ ë‹¤ë¦„!<br/>

í¬ë¡¬ì—ì„œëŠ” ì´ë ‡ê²Œ ë‚˜ì˜¤ì§€ë§Œ íŒŒì´ì–´í­ìŠ¤ì—ì„œëŠ” fulfilledë¼ê³  ë‚˜ì˜´.<br/>

ì„±ê³µí–ˆìŒì„ ëŒ€ì²´í•  ë•Œë„ ìˆê³ , unnsettledì—ì„œ settledë¡œ ë„˜ì–´ê°”ìŒì„ í‘œì‹œí•  ë•Œë„ ìˆìœ¼ë‹ˆ ë¬¸ë§¥ì— ë”°ë¼ íŒŒì•…í•˜ëŠ” ìˆ˜ë°–ì— ì—†ìŒ.



```js
const testRun = param => promiseTest(param)
// promiseTestë¡œ ë§Œë“ ì• ëŠ” promiseì˜ ì¸ìŠ¤í„´ìŠ¤.
// ì¸ìŠ¤í„´ìŠ¤ì´ê¸° ë•Œë¬¸ì— prototypeìƒì˜ thenê³¼ catchë¥¼ ì“¸ ìˆ˜ ìˆë‹¤

  .then(text => { console.log(text) })
  .catch(error => { console.error(error) })

// resolveê°€ ì‹¤í–‰ëœ ìˆœê°„ thenì´ ì‹¤í–‰
// rejectê°€ ì‹¤í–‰ë˜ë©´ catchë¡œ

```

 

```js
const promiseTest = (param, delay) => new Promise((resolve, reject) => {
	setTimeout(() => {
		if (param) {
			resolve("í•´ê²° ì™„ë£Œ")
		} else {
			reject(Error("ì‹¤íŒ¨!!"))
		}
	}, delay)
})
const testRun = param => promiseTest(param, delay)

  .then(text => { console.log(text) })
  .catch(error => { console.error(error) })

const a = testRun(true,1000)
const b = testRun(false,2000)
// í•´ê²°ì™„ë£Œ
// 1ì´ˆ í›„
// Error: ì‹¤íŒ¨!! at setTimeout

```

ê·¸ í›„ ë³€ìˆ˜ë“¤ì„ ë‹¤ì‹œ í˜¸ì¶œí•˜ë©´

```js
a
// Promise{ resolved: undefiled}
b
// Promise{ resolved: undefiled}
```
aëŠ” ì—¬ì „íˆ promiseì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ resolved ìƒíƒœ<br/>
bë„ ì—¬ì „íˆ promiseì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ resolved ìƒíƒœ<br/>

bëŠ” catchë¡œ ì—ëŸ¬ê°€ ë‚œ ìƒíƒœì¸ë°ë„ ì™œ resolvedì§€? <br/>
ë°˜í™˜í•œ ê²ƒ ì—†ì´ ê·¸ëƒ¥ resolveì²˜ë¦¬ë¥¼ ì‹œí‚¨ê²ƒ.<br/>


```js
a.then(() => { return 1; })
// Promise { <resolved>: 1 }
a.then(res => { console.log(res) })
// undefined
// Promise { <resolved>: undefined }

a.then(() => { return 1; })
.then(res => { console.log(res) })
1
// Promise { <resolved>: undefined }

```

ëë‚œ ê²ƒ ê°™ì§€ë§Œ ë‹¤ì‹œ ë‚´ê°€ ì›í•  ë•Œ ì´ì–´ì„œ thenì„ ë˜ í•  ìˆ˜ ìˆë‹¤.<br/>

í•œë²ˆ promiseëŠ” ì˜ì›í•œ promise! ì˜ì›íˆ ì´ì–´ì„œ ê°ˆ ìˆ˜ ìˆë‹¤<br/>

promiseë¥¼ ì¤‘ë‹¨ì‹œí‚¬ ìˆ˜ ì—†ë‹¤ëŠ” ì ì—ì„œ í•œê³„.



### 16-2-2. ë¬¸ë²•

- `new Promise(function)`
- `.then()`, `.catch()`ëŠ” ì–¸ì œë‚˜ promiseë¥¼ ë°˜í™˜í•œë‹¤.

```js
const executer = (resolve, reject) => { ... }
const prom = new Promise(executer)

const onResolve = res => { ... }
const onReject = err => { ... }

// (1)
prom.then(onResolve, onReject)

// (2)
prom.then(onResolve).catch(onReject)
```


(1) <br/>
prom.then(onResolve, onReject)<br/>
thenì•ˆì—ì„œ ì„±ê³µì‹œ í•¨ìˆ˜, ì‹¤íŒ¨ì‹œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤<br/>

```js
const testRun = (param,delay) => promiseTest(param, delay)

  .then(text => { console.log(text) },
  error => { console.error(error)}
);

```

then catchë¥¼ ë‚˜ëˆ ì„œ í•  ìˆ˜ë„ ìˆê³ , ì•„ë˜ì²˜ëŸ¼ í•œë²ˆì— í•  ìˆ˜ë„ ìˆìŒ.


```js
new Promise((resolve, reject) => { ... })
.then(res => { ... })
.catch(err => { ... })
```



```js
const simplePromiseBuilder = value => {
  return new Promise((resolve, reject) => {
    if(value) { resolve(value) }
    else { reject(value) }
  })
}
// valueë¥¼ ë„˜ê²¨ë°›ê³  promiseì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜


simplePromiseBuilder(1)
  .then(res => { console.log(res) })
  .catch(err => { console.error(err) })

simplePromiseBuilder(0)
  .then(res => { console.log(res) })
  .catch(err => { console.error(err) })
```

ì „í˜€ simpleí•˜ì§€ ì•Šë„¤! thenì´ ë˜‘ê°™ì€ ë‚´ìš©ì„ ë°˜ë³µí•˜ê³  ìˆì–´.


```js
const simplePromiseBuilder2 = value => {
  return new Promise((resolve, reject) => {
    if(value) { resolve(value) }
    else { reject(value) }
  })
  .then(res => { console.log(res) })
  .catch(err => { console.error(err) })
}

simplePromiseBuilder2(1)
simplePromiseBuilder2(0)
```
ì´ë ‡ê²Œ ì• ì´ˆì— promiseë¥¼ ë°˜í™˜í•  ë•Œ, ê·¸ ì•ˆì— thenê³¼ catchë¥¼ ë°˜í™˜ì‹œí‚¤ë©´ ëœë‹¤.

```js
simplePromiseBuilder2(0).then(res => {console.log('ì´ì–´ì„œ í•˜ê³ ì‹¶ìœ¼ë©´ í•¨ìˆ˜í˜¸ì¶œì‹œì— ì ìœ¼ì„¸ì—¼')})

const a = simplePromiseBuilder2(1)
a.them(res => { console.log('ë¦¬í„´í•´ì£¼ë©´ ê³„ì† ë´ë´ë´ ê°ˆ ìˆ˜ ìˆì–´ìš”')})

```



```js
const prom = new Promise((resolve, reject) => {
  resolve()
  reject()
  console.log('Promise')
})

// Promise ì¶œë ¥ ëœë‹¤


prom.then(() => {
  console.log('then')
})

prom.catch(() => {
  console.log('catch')
})

console.log('Hi!')

// Promise
// Hi
// then
```
ì¶œë ¥ìˆœì„œ

- 1) Promise
- 2) Hi
- 3) then

ì‹¤í–‰ Queue : ì–´ë–¤ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³ , ê·¸ ë‹¤ìŒ ì´ì–´ì„œ ìˆ˜í–‰í•˜ê³ .... <br/>

ì „ì²´ì†ŒìŠ¤ ì‹¤í–‰í•˜ëŠ” ê³¼ì •ì—ì„œ Promise ì¸ìŠ¤í„´ìŠ¤ì˜ í•¨ìˆ˜ë„ ê°™ì´ ì‹¤í–‰ë˜ì—ˆë‹¤.<br/>
-> ê·¸ë¡œì¸í•´ pendingì—ì„œ fulfilledê°€ ë¨ <br/>
-> fulfilledê°€ ë˜ë©´ì„œ thení•¨ìˆ˜ê°€ queueì— ì¶”ê°€ë¨.<br/>
-> ê³„ì† ì „ì²´ì†ŒìŠ¤ì‹¤í–‰ì´ ëë‚˜ê³  ë‚˜ì„œ<br/>
(í•˜ë‚˜ì˜ í ë)<br/>
-> ë‹¤ìŒë²ˆíì— ìˆëŠ” thení•¨ìˆ˜ê°€ ì‹¤í–‰ë¨.<br/>

=> rejectëŠ” ë¬´ì‹œë˜ì—ˆë„¤??


```js
const prom = new Promise((resolve, reject) => {
  reject()
  resolve()
  console.log('Promise')
})

prom.then(() => {
  console.log('then')
})

prom.catch(() => {
  console.log('catch')
})

console.log('Hi!')

// Promise
// Hi
// catch
```

ìˆœì„œë¥¼ ë°”ê¾¸ë©´? <br/>
ì´ë²ˆì—” thenìœ¼ë¡œ ì•ˆê°€ê³  catchë¡œë§Œ ì™”ë”°!<br/>

=><br/>
1. thenì´ë‚˜ catch êµ¬ë¬¸ì€ ì‹¤í–‰íì— í›„ìˆœìœ„ë¡œ ë“±ë¡ë˜ê³  ì‹¤í–‰ëœë‹¤
2. promise ì¸ìŠ¤í„´ìŠ¤ì— ë„˜ê¸´ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œëŠ”, resolveë‚˜ reject ë‘˜ ì¤‘ì— ë¨¼ì € í˜¸ì¶œí•œ ê²ƒë§Œ ì‹¤ì œë¡œ ì‹¤í–‰ëœë‹¤.
3. ì‚¬ì‹¤ì€ ì‹¤ì œë¡œ ì‹¤í–‰ ì•ˆë˜ëŠ” ê²Œ ì•„ë‹ˆë¼, ***ì‹¤í–‰ì€ ë‘˜ë‹¤ ë˜ëŠ”ë°***, pending ìƒíƒœì¼ ë•Œë§Œ ì˜ë¯¸ê°€ ìˆê¸° ë•Œë¬¸ì— ì´ëŸ° ê²°ê³¼ê°€ ë‚˜ì˜¨ ê²ƒ
- **rejectë¥¼ ì‹¤í–‰**í•˜ë©´ ì´ promì´ë¼ëŠ” **ì¸ìŠ¤í„´ìŠ¤ì˜ promise** ìƒíƒœê°€ `pending` => `resolve(rejected)` ìƒíƒœë¡œ ë³€ê²½
- ì´ë¯¸ resolved ìƒíƒœê°€ ëœ promiseì—ê²Œ **ë‹¤ì‹œ resolveë¥¼ í•˜ë¼ê³  í•  ìˆ˜ ì—†ìŒ**
- ì´ë¯¸ ì²«ë²ˆì§¸ promiseê°€ ëë‚œ ìƒíƒœì´ê¸° ë•Œë¬¸ì— ì–´ë–¤ ëª…ë ¹ì„ ë°›ì„ ìˆ˜ ì—†ë‹¤. ê·¸ë˜ì„œ ì²˜ë¦¬í•˜ì§€ ì•ŠëŠ” ê²ƒ
- rejectì—ì„œ ëë‚´ì„œ ë¦¬í„´í•´ë²„ë¦¬ì§€ ì•Šê³  resolveê°€ **ì‹¤í–‰ì´ ë˜ì—ˆê¸° ë•Œë¬¸ì—** ì•„ë˜ì— ìˆëŠ” console.logê°€ ì‹¤í–‰ëê² ì§€!

=> `reject`ë“  `resolve`ë“ , **`pending` ìƒíƒœì—ì„œë§Œ** í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤<br/>
ì´ promiseìƒíƒœë¥¼ ë¨¼ì € ëë‚´ì„œ pending ìƒíƒœê°€ ì¢…ë£Œë˜ë©´, ë‹¤ìŒì— ì˜¤ëŠ” rejectë˜ëŠ” resolveëŠ” ì˜ë¯¸ê°€ ì‚¬ë¼ì§„ë‹¤<br/>

**ê²°ë¡  )**<br/>
```js
reject() // -ì‹¤í–‰ O, Promise ìƒíƒœ ì¢…ë£Œ
resolve() // - ì‹¤í–‰ O, ì¢…ë£Œëìœ¼ë‹ˆ ì˜ë¯¸ X
console.log('Promise') // - ì‹¤í–‰ O 
```

ì•„ë˜ì²˜ëŸ¼ ë°˜ëŒ€ì˜ ê²½ìš°ë„ ë§ˆì°¬ê°€ì§€

**ê²°ë¡  )**<br/>
```js
resolve() // - ì‹¤í–‰ O, Promise ìƒíƒœ ì¢…ë£Œ
reject() // -ì‹¤í–‰ O, ì¢…ë£Œëìœ¼ë‹ˆ ì˜ë¯¸ X
console.log('Promise') // - ì‹¤í–‰ O 
```



```js
const prom = new Promise((resolve, reject) => {
  reject()
  resolve()
  console.log('Promise')
})
prom.then(() => {
  console.log('then')
})

prom.catch(() => {
  console.log('catch')
})

console.log('Hi!')
```


```js
// 1)
new Promise((resolve, reject) => {
  // ë‚´ìš©ì„ ë³µì¡í•˜ê²Œ
  resolve(10)
})
// Promise {<resolved>:10}

// 2)
Promise.resolve(10)
// Promise {<resolved>:10}

```
1ê³¼ 2ëŠ” ë™ì¼í•œ ê²°ê³¼. <br/>
1ì€ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ì„œ ì „ì²´ì ì¸ í”Œë¡œìš°ë¥¼ ëª¨ë‘ ì‹¤í–‰ì‹œí‚¨ ë’¤ì— ë°˜í™˜ <br/>
2ëŠ” ê·¸ ìì²´ë¡œì¨ 10ì„ ë³´ëƒ„ <br/>

ì™œ 2ì²˜ëŸ¼ ì“¸ê¹Œ? <br/>
`thenable`í•˜ê²Œ ë§Œë“¤ê³  ì‹¶ì–´ì„œ!

```js
Promise.resolve(10).then(res => {})
```
ì²˜ìŒë¶€í„° 10ì´ resolveë¨.

```js
const a = val => Promise.resolve(val)
.then(res => {
  console.log(res)
})

a(10)
// 10
// Promise{<resolve>: undefined}
```

### 16-2-3. í™•ì¥ Promise ë§Œë“¤ê¸°

1. `Promise.resolve`, `Promise.reject`

```js
Promise.resolve(42)
.then(res => { console.log(res) })
.catch(err => { console.error(err) })

Promise.reject(12)
.then(res => { console.log(res) })
.catch(err => { console.error(err) })
```



2. thenable ê°ì²´

ê·¸ëƒ¥ ê°ì²´ì¸ë°, thenì´ë¼ëŠ” ë©”ì†Œë“œê°€ ìˆê³ , <br/>
resolve, reject í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ ë˜ì–´ìˆìœ¼ë©´ <br/>
**`thenable`**í•˜ë‹¤ <br/>


```js
const thenable = {
  then (resolve, reject) {
    resolve(33)
  }
}
const prom = Promise.resolve(thenable)
prom.then(res => { console.log(res) })

// Promise {<resolved>: 33}
```

promì—ëŠ” thenableí•œ ê°ì²´ê°€ ì™€ìˆì„ ê²ƒ ê°™ì•˜ëŠ”ë°, <br/>
ê°ì²´ê°€ ì™€ìˆì§€ ì•Šê³  33ì´ ì™€ìˆë„¤? <br/>

**`Promise.resolve`**ì— ì–´ë– í•œ ê°’ì„ ë„˜ê²¨ì¤„ ë•Œ <br/>

- **thenableí•œ ê°ì²´**ë¥¼ ë„˜ê²¨ì£¼ë©´? <br/>
  - ê±°ê¸°ìˆëŠ” **then ë©”ì†Œë“œë¥¼ í˜¸ì¶œ**í•´ì„œ resolveëœ ê²ƒì„ ë°˜í™˜ <br/>
- **ì¼ë°˜ì ì¸ ê°’**ì„ ë„˜ê²¨ì£¼ë©´? <br/>
  - ê·¸ëƒ¥ ê·¸ ê°’ì„ resolve ìƒíƒœë¡œ ë§Œë“ ë‹¤ <br/>


ê·¸ë˜ì„œ thenì´ **ì´ë¯¸ ì‹¤í–‰ë˜ì—ˆê¸° ë•Œë¬¸ì—** 33ì´ ì˜¨ë‹¤.

```js
const thenable = {
  then (resolve, reject) {
    reject(33)
  }
}
const prom = Promise.resolve(thenable)
prom.catch(err => { console.log(err) })
```

ì´ê²ƒì²˜ëŸ¼ thenì„ íƒœìš¸ ìˆ˜ ìˆëŠ” ê²ƒë“¤ì€ ì „ë¶€ thenableí•˜ë‹¤ <br/>
promiseì—ì„œ ë°˜í™˜ë˜ëŠ” ê²ƒë“¤ì€ ëª¨ë‘ thenableí•˜ë‹¤


```js
const thenable = {
  then() {
    return 10;
  }
}

const prom = Promise.resolve(thenable)
prom
// Promise {<pending>}

```
then ë©”ì†Œë“œëŠ” ìˆì§€ë§Œ resolveì™€ rejectë¥¼ í•¨ìˆ˜ë¥¼ í˜¸ì¶œì‹œí‚¤ì§€ ì•Šìœ¼ë©´? <br/>

thenì„ íƒ€ë ¤ê³  í–ˆëŠ”ë° ê·¸ ì•ˆì—ì„œ resolveë¥¼ ì•ˆì‹œí‚¤ë‹ˆê¹Œ <br/>
ê³„ì† ëë‚  ìˆ˜ê°€ ì—†ëŠ” ìƒíƒœë¡œ ë©ˆì¶°ìˆë‹¤ <br/>

=> thenableí•˜ì§€ âŒ <br/>
then ë©”ì†Œë“œê°€ ì œëŒ€ë¡œ êµ¬í˜„ë˜ì–´ìˆì§€ ì•ŠìŒ


```js
const thenable = {
  then(resolve) {
    resolve(10);
  }
}

const prom = Promise.resolve(thenable)
prom
// Promise {<resolved>: 10}

```

ì´ë ‡ê²Œ ë°˜ë“œì‹œ resolveë¥¼ ë§Œë“¤ì–´ì¤˜ì•¼í•¨. <br/>


```js
const thenable = {
  then(a) {
    a(10);
  }
}

const prom = Promise.resolve(thenable)
prom
// Promise {<resolved>: 10}

```

ì´ë¦„ ë°”ê¿”ë„ ìƒê´€ì—†ìŒ.

```js
const thenable = {
  then(a,b) {
    b(10);
  }
}

const prom = Promise.resolve(thenable)
prom
// Uncaught ( in promise) 10

```
ì‹¤íŒ¨í•˜ê²Œ í•˜ë ¤ë©´ ì´ë ‡ê²Œ

### 16-2-4. Promise Chaning (then, catchì—ì„œ return)

â­ï¸ promiseì—ì„œ ì œì¼ ì¤‘ìš”í•œ ***promise chaning***! â­ï¸ <br/>

ì•„ê¹Œ ë°°ì› ë“¯ì´<br/>
promiseì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ resolve ë˜ë©´, ê·¸ ë’¤ì— thenì„ íƒ.<br/>
ê·¸ëŸ¼ ê·¸ ì´í›„ë¡œ **ì˜ì›íˆ** thenì„ íƒœìš¸ ìˆ˜ ìˆìŒ<br/>

> thení•¨ìˆ˜ì—ì„œì˜ **`return`**<br/>
ê±°ê¸°ì„œ ë­˜ return í•´ì£¼ë©´ **returní•œ ê²ƒ ê·¸ ìì²´**ê°€<br/>
**ë‹¤ìŒë²ˆ then**ì„ íƒˆ ë•Œ **`resolveì˜ ê²°ê³¼`**ë¡œ ë“¤ì–´ê°„ë‹¤!

```js
new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve('ì²«ë²ˆì§¸ í”„ë¼ë¯¸ìŠ¤')
  }, 1000)
  // 1ì´ˆ ë’¤ promiseì˜ ìƒíƒœë¥¼ pendingì—ì„œ resolvedë¡œ ë°”ê¿”, ê°’ì€ 'ì²«ë²ˆì§¸ í”„ë¼ë¯¸ìŠ¤'
}).then(res => {
  console.log(res) // 'ì²«ë²ˆì§¸ í”„ë¼ë¯¸ìŠ¤'
  return 'ë‘ë²ˆì§¸ í”„ë¼ë¯¸ìŠ¤'
  // ì´ë¯¸ promise resolveê°€ ëœ ìƒíƒœì¸ë°, ë‹¤ìŒë²ˆ thenì„ íƒ€ë©´
  // ë‹¤ì‹œ pendingì´ ëë‹¤ê°€ returní•œ ê²ƒ ê·¸ìì²´ê°€ resolveì˜ ê²°ê³¼ë¡œ ë‚˜ì˜´
  // ê²½ìš° 2ë²ˆì˜ ì¼ë°˜ê°’ì´ë‹ˆê¹Œ ë‹¤ìŒë²ˆ thenì„ íƒˆ ìˆ˜ ìˆìŒ 
}).then(res => {
  console.log(res) // 'ë‘ë²ˆì§¸ í”„ë¼ë¯¸ìŠ¤'
  return new Promise((resolve, reject) => {
    setTimeout(() => {
          resolve('ì„¸ë²ˆì§¸ í”„ë¼ë¯¸ìŠ¤')
    }, 1000)
  })
  // ê²½ìš° 1ë²ˆ. ì´ ìì²´ê°€ thenableí•˜ê²Œ ë  ë•Œ ë‹¤ìŒë²ˆ thenì„ íƒ. 
  // ìƒˆë¡œìš´ promiseì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ return, 1ì´ˆ ë’¤ì— resolve => thenableì´ ë¨ 
}).then(res => {
  console.log(res) // 1ì´ˆ í›„, 'ì„¸ë²ˆì§¸ í”„ë¼ë¯¸ìŠ¤' 
  return new Promise((resolve, reject) => {
    setTimeout(() => {
          reject('ë„¤ë²ˆì§¸ í”„ë¼ë¯¸ìŠ¤')
    }, 1000)
  })
  // resolveë“  rejectë“  í•  ë•Œ thenableí•˜ê²Œ ë¨
  // ë‹¤ìŒë²ˆ thenì„ ë¬´ì‹œí•˜ê³  catchë¡œ ê°.
}).then(res => {
  console.log(res)
}).catch(err => {
  console.error(err) // ë„¤ë²ˆì§¸ í”„ë¼ë¯¸ìŠ¤ê°€ ì—ëŸ¬ë¡œ ë‚˜ì˜´ 
  return new Error('ì´ ì—ëŸ¬ëŠ” thenì— ì¡í™ë‹ˆë‹¤.')
  // then, catchì—ì„œ returní•˜ë©´ ì¸ìŠ¤í„´ìŠ¤ ë¦¬í„´ì´ ì•„ë‹Œ ê²½ìš°ì—ëŠ” ê²½ìš°2ë²ˆìœ¼ë¡œ ì¼ë°˜ê°’
  // promiseì˜ resolve ìƒíƒœë¡œ ê°’ìœ¼ë¡œ ë„˜ì–´ê°„ë‹¤ => thenìœ¼ë¡œ
}).then(res => {
  console.log(res)
  throw new Error('ì´ ì—ëŸ¬ëŠ” catchì— ì¡í™ë‹ˆë‹¤.')
  // throw : í˜„ì¬ìƒíƒœë¥¼ ì¤‘ë‹¨í•˜ê³  ì—ëŸ¬ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•¨. => then ë¬´ì‹œí•˜ê³  catchë¡œ
}).then(res => {
  console.log('ì¶œë ¥ ì•ˆë¨')
}).catch(err => {
  console.error(err)
})
```

â­ï¸ .thenì´ë‚˜ catchì•ˆì—ì„œ <br/>
- ê²½ìš°1. return promise `ì¸ìŠ¤í„´ìŠ¤` : promise ì¸ìŠ¤í„´ìŠ¤ê°€ ë¦¬í„´ëœ ê²ƒ<br/>
  - returnëœ ì• ë„ promise
  - ì‹¤í–‰ê²°ê³¼ê°€ ì–¸ì  ê°€ pendingì—ì„œ resolveë¡œ ë°”ë€œ
  - ê·¸ëŸ¼ ë‹¤ì‹œ ê·¸ ë‹¤ìŒ **thenì„ íƒˆ ìˆ˜ ìˆìŒ**
- ê²½ìš°2. return `ì¼ë°˜ê°’` : promise ê°ì²´ì— resolved ìƒíƒœë¡œ ë°˜í™˜. ê·¸ ì•ˆì— ê°’ì´ ë‹´ê¹€<br/>
  - Promise { <resolve>:  ê°’ } ì´ë ‡ê²Œ
- ê²½ìš°3. return ì•ˆí•˜ë©´ : return undefined (ì›ë˜ JS ë™ì‘ì´ ì´ëŸ¬í•¨)
  - undefinedê°€ ê³§ ì¼ë°˜ê°’. = 2ë²ˆê³¼ ê°™ë‹¤
- ê²½ìš°4. Promise.resolve() ë˜ëŠ” Promise.reject()
  - returní•˜ì§€ ì•ŠëŠ” ì´ìƒ ì˜ë¯¸ì—†ìŒ! (returní•˜ë©´ 1ë²ˆê³¼ ê°™ë‹¤)
  - ê·¸ëƒ¥ ìƒˆë¡œìš´ promiseì¼ ë¿, ë‚´ê°€ ì§€ê¸ˆ ì‡ê³ ìˆëŠ” ì‹œí€€ìŠ¤ì™€ëŠ” ì™„ì „íˆ ë³„ê°œ.
  - ë‹¤ì‹œë§í•´ .then(() -> {}).then(() -> {}) ì— ì˜í–¥ì£¼ì§€ âŒ

ê²°ê³¼! <br/>
<img src="/assets/images/promise_result.png" /><br/>


### 16-2-5. Error Handling

```js
asyncThing1()
.then(asyncThing2)
.then(asyncThing3)
.catch(asyncRecovery1)
.then(asyncThing4, asyncRecovery2)
.catch(err => { console.log("Don't worry about it") })
.then(() => { console.log("All done!") })
```

![ì—ëŸ¬ í•¸ë“¤ë§](https://raw.githubusercontent.com/js-jsm/es6js/master/15%20%ED%94%84%EB%9D%BC%EB%AF%B8%EC%8A%A4/promise_chaining.png)

### 16-2-6. Multi Handling

#### 1. `Promise.all()`

- iterableì˜ ëª¨ë“  ìš”ì†Œê°€ fulfilledë˜ëŠ” ê²½ìš°: ì „ì²´ ê²°ê³¼ê°’ë“¤ì„ ë°°ì—´ í˜•íƒœë¡œ thenì— ì „ë‹¬.
- iterableì˜ ìš”ì†Œ ì¤‘ ì¼ë¶€ê°€ rejectedë˜ëŠ” ê²½ìš°: ê°€ì¥ ë¨¼ì € rejected ë˜ëŠ” ìš”ì†Œ 'í•˜ë‚˜'ì˜ ê²°ê³¼ë¥¼ catchì— ì „ë‹¬.

```js
const arr = [
	1,
	new Promise((resolve, reject) => {
		setTimeout(()=> {
			resolve('resolved after 1000ms')
		}, 1000)
	}),
	'abc',
	() => 'not called function',
	(() => 'IIFE')()
]

Promise.all(arr)
.then(res => { console.log(res) })
.catch(err => { console.error(err) })
```

```js
const arr = [
	1,
	new Promise((resolve, reject) => {
		setTimeout(()=> {
			reject('rejected after 1000ms')
		}, 1000)
	}),
	'abc',
	()=> 'not called function',
	(()=> 'IIFE')()
]

Promise.all(arr)
.then(res => { console.log(res) })
.catch(err => { console.error(err) })
```


#### 2. `Promise.race()`

- iterableì˜ ìš”ì†Œ ì¤‘ ê°€ì¥ ë¨¼ì € fulfilled / rejectedë˜ëŠ” ìš”ì†Œì˜ ê²°ê³¼ë¥¼ then / catchì— ì „ë‹¬.

```js
const arr = [
	new Promise(resolve => {
		setTimeout(()=> { resolve('1ë²ˆìš”ì†Œ, 1000ms') }, 1000)
	}),
	new Promise(resolve => {
		setTimeout(()=> { resolve('2ë²ˆìš”ì†Œ, 500ms') }, 500)
	}),
	new Promise(resolve => {
		setTimeout(()=> { resolve('3ë²ˆìš”ì†Œ, 750ms') }, 750)
	})
]
Promise.race(arr)
.then(res => { console.log(res) })
.catch(err => { console.error(err) })
```

```js
const arr = [
	new Promise(resolve => {
		setTimeout(()=> { resolve('1ë²ˆìš”ì†Œ, 0ms') }, 0)
	}),
	'no queue'
]
Promise.race(arr)
.then(res => { console.log(res) })
.catch(err => { console.error(err) })
```

> ì°¸ê³ : [ES2017 Async Function](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/async_function)
